<html>
<head>
<script>
  function get_favorite_style(){
    return localStorage["favorite_style"] || "native";
  }

  function regexp_list(value){
    var regs = value.split("\n");
    var res = [];
    for (var idx in regs){
        var rs = regs[idx].replace(/^\s+|\s+$/g, '');
        if (rs){
            res.push(new RegExp(rs));
        }
    }
    return res;
  }

  function is_defered_page(url){
    var defered = regexp_list(localStorage["defered_pages"]);
    for (var idx in defered) {
        if (defered[idx].test(url)){
            return true;
        }
    }
    return /[\w\d-]+\.ya\.ru(?!\/(post|repl))/.test(url);
  }

  function is_disabled_page(url){
    var disabled = regexp_list(localStorage["disabled_pages"]);
    for (var idx in disabled){
        if (disabled[idx].test(url)){
            return true;
        }
    }
    return false;
  }

  chrome.extension.onRequest.addListener(
  function(request, sender, sendResponse) {
    switch(request.ask){
        case "favorite_style": sendResponse({favorite_style: get_favorite_style()});

        case "page_settings": sendResponse({no_highlight: is_disabled_page(sender.tab.url), defered_highlight: is_defered_page(sender.tab.url)});

        default: sendResponse({});
    }
  });
</script>
</head>
</html>
